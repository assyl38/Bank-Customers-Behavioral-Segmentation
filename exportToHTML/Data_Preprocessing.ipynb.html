<html>
<head>
<title>Data_Preprocessing.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #cc7832;}
.s2 { color: #a9b7c6;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Data_Preprocessing.ipynb</font>
</center></td></tr></table>
<pre><span class="s0">#%% 
</span><span class="s1">import </span><span class="s2">numpy </span><span class="s1">as </span><span class="s2">np</span>
<span class="s1">import </span><span class="s2">pandas </span><span class="s1">as </span><span class="s2">pd</span>
<span class="s1">import </span><span class="s2">matplotlib.pyplot </span><span class="s1">as </span><span class="s2">plt</span>
<span class="s1">import </span><span class="s2">py </span><span class="s1">as </span><span class="s2">py</span>
<span class="s1">import </span><span class="s2">seaborn </span><span class="s1">as </span><span class="s2">sns</span>
<span class="s1">from </span><span class="s2">sklearn.preprocessing </span><span class="s1">import </span><span class="s2">StandardScaler</span>
<span class="s1">from </span><span class="s2">scipy.cluster.hierarchy </span><span class="s1">import </span><span class="s2">dendrogram</span><span class="s1">, </span><span class="s2">linkage</span>
<span class="s1">from </span><span class="s2">sklearn.cluster </span><span class="s1">import </span><span class="s2">KMeans</span>
<span class="s0">#%% md 
</span><span class="s2"># Importing the clients dataset 
</span><span class="s0">#%% 
</span><span class="s2">data = pd.read_csv(</span><span class="s3">r'C:\Users\ASUS\Downloads\CLIENT.csv'</span><span class="s1">,</span><span class="s2">sep=</span><span class="s3">';' </span><span class="s1">, </span><span class="s2">index_col=</span><span class="s1">False, </span><span class="s2">dtype=</span><span class="s3">'unicode'</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">pd.set_option(</span><span class="s3">&quot;display.max.columns&quot;</span><span class="s1">, None</span><span class="s2">)</span>
<span class="s0">#%% md 
</span><span class="s2"># Exploratory Data Analysis (EDA) 
 
</span><span class="s0">#%% 
</span><span class="s2">data.head()</span>
<span class="s0">#%% 
</span><span class="s2">data.tail()</span>
<span class="s0">#%% 
</span><span class="s2">data.shape</span>
<span class="s0">#%% 
</span><span class="s2">data.columns</span>
<span class="s0">#%% 
</span><span class="s2">data.nunique()</span>
<span class="s0">#%% 
</span><span class="s2">data.describe().T</span>
<span class="s0">#%% md 
</span><span class="s2">### Checking missing values 
</span><span class="s0">#%% 
</span><span class="s2">data.isnull().any()</span>
<span class="s0">#%% md 
</span><span class="s2">--&gt; The columns with numeric values 'CLIENT_AGE' , 'CLIENT_REVENUS_MENSUELS_NETS' contain null values 
</span><span class="s0">#%% 
</span><span class="s1">import </span><span class="s2">missingno </span><span class="s1">as </span><span class="s2">msno</span>
<span class="s2">%matplotlib inline</span>
<span class="s2">msno.matrix(data.sample(</span><span class="s4">250</span><span class="s2">))</span>
<span class="s0">#%% 
</span><span class="s2">data = data.dropna(subset=[</span><span class="s3">'CLIENT_AGE'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_OPCVM'</span><span class="s2">])</span>
<span class="s0">#%% 
#Assigning types to data</span>
<span class="s2">print (data.info())</span>
<span class="s2">data.CLIENT_ID = data.CLIENT_ID.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_AGE = data.CLIENT_AGE.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_ENCOURS_A_VUE = data.CLIENT_ENCOURS_A_VUE.replace(</span><span class="s3">','</span><span class="s1">,</span><span class="s3">'.'</span><span class="s1">, </span><span class="s2">regex=</span><span class="s1">True</span><span class="s2">).astype(</span><span class="s3">'float'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_ENCOURS_ENGAGEMENT = data.CLIENT_ENCOURS_ENGAGEMENT.replace(</span><span class="s3">','</span><span class="s1">,</span><span class="s3">'.'</span><span class="s1">, </span><span class="s2">regex=</span><span class="s1">True</span><span class="s2">).astype(</span><span class="s3">'float'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_MMM = data.CLIENT_MMM.replace(</span><span class="s3">','</span><span class="s1">,</span><span class="s3">'.'</span><span class="s1">, </span><span class="s2">regex=</span><span class="s1">True</span><span class="s2">).astype(</span><span class="s3">'float'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_REVENUS_MENSUELS_NETS = data.CLIENT_REVENUS_MENSUELS_NETS.replace(</span><span class="s3">','</span><span class="s1">,</span><span class="s3">'.'</span><span class="s1">, </span><span class="s2">regex=</span><span class="s1">True</span><span class="s2">).astype(</span><span class="s3">'float'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_VRD_MOY = data.CLIENT_VRD_MOY.replace(</span><span class="s3">','</span><span class="s1">,</span><span class="s3">'.'</span><span class="s1">, </span><span class="s2">regex=</span><span class="s1">True</span><span class="s2">).astype(</span><span class="s3">'float'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_BABY = data.CLIENT_NOMBRE_PACK_BABY.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_BUSINESS = data.CLIENT_NOMBRE_PACK_BUSINESS.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_ELITE = data.CLIENT_NOMBRE_PACK_ELITE.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_ELITE_PRO = data.CLIENT_NOMBRE_PACK_ELITE_PRO.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_EPARGNE = data.CLIENT_NOMBRE_PACK_EPARGNE.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_EXPRESS = data.CLIENT_NOMBRE_PACK_EXPRESS.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_FIRST = data.CLIENT_NOMBRE_PACK_FIRST.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_NAJAH = data.CLIENT_NOMBRE_PACK_NAJAH.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_PLATI_PRO = data.CLIENT_NOMBRE_PACK_PLATI_PRO.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_PLATIN = data.CLIENT_NOMBRE_PACK_PLATIN.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_SAFIR = data.CLIENT_NOMBRE_PACK_SAFIR.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_SAFIR_PRO = data.CLIENT_NOMBRE_PACK_SAFIR_PRO.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_TOUN = data.CLIENT_NOMBRE_PACK_TOUN.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_TOUN_DVS = data.CLIENT_NOMBRE_PACK_TOUN_DVS.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_UNIV = data.CLIENT_NOMBRE_PACK_UNIV.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PACK_SILVER = data.CLIENT_NOMBRE_PACK_SILVER.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_OPCVM = data.CLIENT_NOMBRE_OPCVM.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_TITRES = data.CLIENT_NOMBRE_TITRES.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_CARTES = data.CLIENT_NOMBRE_CARTES.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_BIATNET = data.CLIENT_NOMBRE_BIATNET.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s2">data.CLIENT_NOMBRE_PROJET_AVENIR = data.CLIENT_NOMBRE_PROJET_AVENIR.astype(</span><span class="s3">'int'</span><span class="s2">)</span>
<span class="s0">#%% 
#The data has outliers, hence it's best to fill null values with the median</span>
<span class="s2">data.fillna(data.median())</span>
<span class="s0">#%% md 
</span><span class="s2">There are 16 columns containing the packs of the clients, they will be put in two coulnms only, with the first answering whether the customer is enroled to a pck or not (boolean) 
and the second returning the number of packs each customer has (integer) 
</span><span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'PACK'</span><span class="s2">] = </span><span class="s3">''</span>
<span class="s2">data[</span><span class="s3">'PACK'</span><span class="s2">] = np.where((data[</span><span class="s3">'CLIENT_NOMBRE_PACK_SAFIR'</span><span class="s2">] &gt; </span><span class="s4">0</span><span class="s2">) | (data[</span><span class="s3">'CLIENT_NOMBRE_PACK_ELITE'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">)</span>
                        <span class="s2">|(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_ELITE_PRO'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">) |(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_EPARGNE'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">)</span>
                        <span class="s2">|(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_EXPRESS'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">) |(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_FIRST'</span><span class="s2">] &gt; </span><span class="s4">0</span><span class="s2">)</span>
                        <span class="s2">|(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_NAJAH'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">) |(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_PLATI_PRO'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">)</span>
                        <span class="s2">|(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_PLATIN'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">) |(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_SAFIR'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">)</span>
                        <span class="s2">|(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_SAFIR_PRO'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">) |(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_SILVER'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">)</span>
                        <span class="s2">|(data[</span><span class="s3">'CLIENT_NOMBRE_PACK_UNIV'</span><span class="s2">] &gt; </span><span class="s4">0 </span><span class="s2">)</span>
                        <span class="s1">, True, False</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'PACK'</span><span class="s2">]</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'TOTAL_PACK'</span><span class="s2">] = </span><span class="s3">''</span>

<span class="s2">cols = [</span><span class="s3">'CLIENT_NOMBRE_PACK_ELITE'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_ELITE_PRO'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_EPARGNE'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_EXPRESS'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_FIRST'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_NAJAH'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_PLATI_PRO'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_PLATIN'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_SAFIR'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_SAFIR_PRO'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_SILVER'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_UNIV'</span><span class="s2">]</span>
<span class="s2">data[</span><span class="s3">'TOTAL_PACK'</span><span class="s2">] = data[cols].sum(axis=</span><span class="s4">1</span><span class="s2">)</span>

<span class="s0">#%% 
</span><span class="s2">data.TOTAL_PACK = data.TOTAL_PACK.replace(</span><span class="s3">','</span><span class="s1">,</span><span class="s3">'.'</span><span class="s1">, </span><span class="s2">regex=</span><span class="s1">True</span><span class="s2">).astype(</span><span class="s3">'float'</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'TOTAL_PACK'</span><span class="s2">].describe()</span>
<span class="s0">#%% 
</span><span class="s2">data=data.drop(columns = [</span><span class="s3">'CLIENT_NOMBRE_PACK_ELITE'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_ELITE_PRO'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_EPARGNE'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_EXPRESS'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_FIRST'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_NAJAH'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_PLATI_PRO'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_PLATIN'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_SAFIR'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_SAFIR_PRO'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_SILVER'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_UNIV'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_BABY'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_BUSINESS'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_TOUN'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PACK_TOUN_DVS'</span><span class="s2">])</span>
<span class="s2">data</span>
<span class="s0">#%% 
# Histogram and density of clients ages</span>
<span class="s1">import </span><span class="s2">warnings</span>
<span class="s2">warnings.filterwarnings(</span><span class="s3">'ignore'</span><span class="s2">)</span>
<span class="s2">sns.distplot(data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">]</span><span class="s1">, </span><span class="s2">hist=</span><span class="s1">True, </span><span class="s2">kde=</span><span class="s1">True,</span>
             <span class="s2">bins=int(</span><span class="s4">180</span><span class="s2">/</span><span class="s4">5</span><span class="s2">)</span><span class="s1">, </span><span class="s2">color = </span><span class="s3">'darkblue'</span><span class="s1">,</span>
             <span class="s2">hist_kws={</span><span class="s3">'edgecolor'</span><span class="s2">:</span><span class="s3">'black'</span><span class="s2">}</span><span class="s1">,</span>
             <span class="s2">kde_kws={</span><span class="s3">'linewidth'</span><span class="s2">: </span><span class="s4">4</span><span class="s2">});</span>
<span class="s0">#%% md 
</span><span class="s2">--&gt; The feature AGE is Gaussian Distributed 
</span><span class="s0">#%% 
#Plot distributions for the feautures</span>
<span class="s2">warnings.filterwarnings(</span><span class="s3">'ignore'</span><span class="s2">)</span>
<span class="s2">plt.figure(figsize=(</span><span class="s4">16</span><span class="s1">,</span><span class="s4">5</span><span class="s2">))</span>
<span class="s2">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">1</span><span class="s2">)</span>
<span class="s2">sns.distplot(data[</span><span class="s3">'CLIENT_MMM'</span><span class="s2">])</span>
<span class="s2">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">2</span><span class="s2">)</span>
<span class="s2">sns.distplot(data[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s2">--&gt; The feature MMM and VRD are skewed 
 
</span><span class="s0">#%% md 
</span><span class="s2">### Detecting outliers 
</span><span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">].value_counts()</span>
<span class="s0">#%% 
</span><span class="s2">sns.set_theme(style=</span><span class="s3">&quot;whitegrid&quot;</span><span class="s2">)</span>
<span class="s2">ax = sns.boxplot(x = data[</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s2">] </span><span class="s1">,</span><span class="s2">data = data)</span>
<span class="s0">#%% md 
</span><span class="s2">The reasonable range of age is between 18 and 80 years old 
</span><span class="s0">#%% 
#Knowing that the age range should be between 18 and 80, the outliers will be removed</span>
<span class="s2">index = data[(data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">] &gt;= </span><span class="s4">80</span><span class="s2">)|(data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">] &lt;= </span><span class="s4">18</span><span class="s2">)].index</span>
<span class="s2">data.drop(index</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">].describe()</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">].value_counts().plot.bar(figsize = (</span><span class="s4">15</span><span class="s1">, </span><span class="s4">9</span><span class="s2">))</span>

<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">10</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">plt.title(</span><span class="s3">&quot;Age Frequency&quot;</span><span class="s2">)</span>
<span class="s2">sns.axes_style(</span><span class="s3">&quot;dark&quot;</span><span class="s2">)</span>
<span class="s2">sns.violinplot(y=data[</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s2">--&gt; The clients are more frequent at around the age of 30. 
</span><span class="s0">#%% 
</span><span class="s1">import </span><span class="s2">scipy.stats </span><span class="s1">as </span><span class="s2">stat</span>
<span class="s1">import </span><span class="s2">pylab</span>
<span class="s0">#### If you want to check whether feature is guassian or normal distributed</span>
<span class="s0">#### Q-Q plot</span>
<span class="s1">def </span><span class="s2">plot_data(df</span><span class="s1">,</span><span class="s2">feature):</span>
    <span class="s2">plt.figure(figsize=(</span><span class="s4">10</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
    <span class="s2">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s2">df[feature].hist()</span>
    <span class="s2">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s2">stat.probplot(df[feature]</span><span class="s1">,</span><span class="s2">dist=</span><span class="s3">'norm'</span><span class="s1">,</span><span class="s2">plot=pylab)</span>
    <span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plot_data(data </span><span class="s1">, </span><span class="s3">'CLIENT_AGE'</span><span class="s2">)</span>

<span class="s0">#%% 
</span><span class="s2">plot_data(data </span><span class="s1">, </span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">plot_data(data </span><span class="s1">, </span><span class="s3">'CLIENT_MMM'</span><span class="s2">)</span>

<span class="s0">#%% 
</span><span class="s2">data.select_dtypes(include=np.number)</span>
<span class="s0">#%% 
</span><span class="s2">Q1=data[[</span><span class="s3">&quot;CLIENT_MMM&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_OPCVM&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_TITRES&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_VRD_MOY&quot;</span>
         <span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_CARTES&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_BIATNET&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_PROJET_AVENIR&quot;</span><span class="s1">,</span>
         <span class="s3">&quot;CLIENT_ENCOURS_A_VUE&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_ENCOURS_ENGAGEMENT&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_REVENUS_MENSUELS_NETS&quot;</span><span class="s1">,</span><span class="s3">&quot;TOTAL_PACK&quot;</span><span class="s2">]].describe().T[</span><span class="s3">&quot;25%&quot;</span><span class="s2">]</span>
<span class="s2">Q3=data[[</span><span class="s3">&quot;CLIENT_MMM&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_OPCVM&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_TITRES&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_VRD_MOY&quot;</span>
         <span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_CARTES&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_BIATNET&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_NOMBRE_PROJET_AVENIR&quot;</span><span class="s1">,</span>
         <span class="s3">&quot;CLIENT_ENCOURS_A_VUE&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_ENCOURS_ENGAGEMENT&quot;</span><span class="s1">,</span><span class="s3">&quot;CLIENT_REVENUS_MENSUELS_NETS&quot;</span><span class="s1">,</span><span class="s3">&quot;TOTAL_PACK&quot;</span><span class="s2">]].describe().T[</span><span class="s3">&quot;75%&quot;</span><span class="s2">].T</span>
<span class="s2">IQR=(Q3-Q1)</span>
<span class="s0">#%% 
</span><span class="s2">data[data.CLIENT_MMM&lt;(Q1.CLIENT_MMM - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_MMM)]</span>
<span class="s2">data.drop(data[data.CLIENT_MMM&gt;(Q3.CLIENT_MMM + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_MMM)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_NOMBRE_OPCVM&lt;(Q1.CLIENT_NOMBRE_OPCVM - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_NOMBRE_OPCVM)]</span>
<span class="s2">data.drop(data[data.CLIENT_NOMBRE_OPCVM&gt;(Q3.CLIENT_NOMBRE_TITRES + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_NOMBRE_OPCVM)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_NOMBRE_TITRES&lt;(Q1.CLIENT_NOMBRE_TITRES - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_NOMBRE_TITRES)]</span>
<span class="s2">data.drop(data[data.CLIENT_NOMBRE_TITRES&gt;(Q3.CLIENT_NOMBRE_TITRES + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_NOMBRE_TITRES)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_VRD_MOY&lt;(Q1.CLIENT_VRD_MOY - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_VRD_MOY)]</span>
<span class="s2">data.drop(data[data.CLIENT_VRD_MOY&gt;(Q3.CLIENT_VRD_MOY + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_VRD_MOY)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_NOMBRE_CARTES&lt;(Q1.CLIENT_NOMBRE_CARTES - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_NOMBRE_CARTES)]</span>
<span class="s2">data.drop(data[data.CLIENT_NOMBRE_CARTES&gt;(Q3.CLIENT_NOMBRE_CARTES + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_NOMBRE_CARTES)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_NOMBRE_BIATNET&lt;(Q1.CLIENT_NOMBRE_BIATNET - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_NOMBRE_BIATNET)]</span>
<span class="s2">data.drop(data[data.CLIENT_NOMBRE_BIATNET&gt;(Q3.CLIENT_NOMBRE_BIATNET + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_NOMBRE_BIATNET)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_NOMBRE_PROJET_AVENIR&lt;(Q1.CLIENT_NOMBRE_PROJET_AVENIR - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_NOMBRE_PROJET_AVENIR)]</span>
<span class="s2">data.drop(data[data.CLIENT_NOMBRE_PROJET_AVENIR&gt;(Q3.CLIENT_NOMBRE_PROJET_AVENIR + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_NOMBRE_PROJET_AVENIR)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_ENCOURS_A_VUE&lt;(Q1.CLIENT_ENCOURS_A_VUE - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_ENCOURS_A_VUE)]</span>
<span class="s2">data.drop(data[data.CLIENT_ENCOURS_A_VUE&gt;(Q3.CLIENT_ENCOURS_A_VUE + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_ENCOURS_A_VUE)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_ENCOURS_ENGAGEMENT&lt;(Q1.CLIENT_ENCOURS_ENGAGEMENT - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_ENCOURS_ENGAGEMENT)]</span>
<span class="s2">data.drop(data[data.CLIENT_ENCOURS_ENGAGEMENT&gt;(Q3.CLIENT_ENCOURS_ENGAGEMENT+ </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_ENCOURS_ENGAGEMENT)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.CLIENT_REVENUS_MENSUELS_NETS&lt;(Q1.CLIENT_REVENUS_MENSUELS_NETS - </span><span class="s4">3 </span><span class="s2">* IQR.CLIENT_REVENUS_MENSUELS_NETS)]</span>
<span class="s2">data.drop(data[data.CLIENT_REVENUS_MENSUELS_NETS&gt;(Q3.CLIENT_REVENUS_MENSUELS_NETS + </span><span class="s4">3  </span><span class="s2">* IQR.CLIENT_REVENUS_MENSUELS_NETS)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[data.TOTAL_PACK&lt;(Q1.TOTAL_PACK - </span><span class="s4">3 </span><span class="s2">* IQR.TOTAL_PACK)]</span>
<span class="s2">data.drop(data[data.TOTAL_PACK&gt;(Q3.TOTAL_PACK + </span><span class="s4">3  </span><span class="s2">* IQR.TOTAL_PACK)].index</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">16</span><span class="s1">,</span><span class="s4">5</span><span class="s2">))</span>
<span class="s2">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">1</span><span class="s2">)</span>
<span class="s2">sns.distplot(data[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plot_data(data </span><span class="s1">, </span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">)</span>

<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">].describe()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">16</span><span class="s1">,</span><span class="s4">5</span><span class="s2">))</span>
<span class="s2">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">1</span><span class="s2">)</span>
<span class="s2">sns.distplot(data[</span><span class="s3">'CLIENT_MMM'</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plot_data(data </span><span class="s1">, </span><span class="s3">'CLIENT_MMM'</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_MMM'</span><span class="s2">].describe()</span>

<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_ENCOURS_A_VUE'</span><span class="s2">].describe()</span>

<span class="s0">#%% 
</span><span class="s2">sns.set(style=</span><span class="s3">&quot;ticks&quot;</span><span class="s1">, </span><span class="s2">color_codes=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">gggg = sns.pairplot(data </span><span class="s1">, </span><span class="s2">vars=[</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s1">, </span><span class="s3">&quot;CLIENT_NOMBRE_BIATNET&quot;</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">sns.set(style=</span><span class="s3">&quot;ticks&quot;</span><span class="s1">, </span><span class="s2">color_codes=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">g = sns.pairplot(data </span><span class="s1">, </span><span class="s2">vars=[</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s1">, </span><span class="s3">&quot;CLIENT_MMM&quot;</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">sns.set(style=</span><span class="s3">&quot;ticks&quot;</span><span class="s1">, </span><span class="s2">color_codes=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">fggg = sns.pairplot(data </span><span class="s1">, </span><span class="s2">vars=[</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s1">, </span><span class="s3">&quot;CLIENT_ENCOURS_A_VUE&quot;</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">sns.set(style=</span><span class="s3">&quot;ticks&quot;</span><span class="s1">, </span><span class="s2">color_codes=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">gg = sns.pairplot(data </span><span class="s1">, </span><span class="s2">vars=[</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s1">, </span><span class="s3">&quot;TOTAL_PACK&quot;</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">sns.relplot(x=</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s1">, </span><span class="s2">y=</span><span class="s3">&quot;CLIENT_MMM&quot;</span><span class="s1">, </span><span class="s2">hue=</span><span class="s3">&quot;PACK&quot;</span><span class="s1">,</span>
            <span class="s2">sizes=(</span><span class="s4">40</span><span class="s1">, </span><span class="s4">400</span><span class="s2">)</span><span class="s1">, </span><span class="s2">alpha=</span><span class="s4">.5</span><span class="s1">, </span><span class="s2">palette=</span><span class="s3">&quot;muted&quot;</span><span class="s1">,</span>
            <span class="s2">height=</span><span class="s4">6</span><span class="s1">, </span><span class="s2">data=data)</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize = (</span><span class="s4">50</span><span class="s1">, </span><span class="s4">20</span><span class="s2">))</span>
<span class="s2">ax = sns.boxplot(x = data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y = data[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">]</span><span class="s1">, </span><span class="s2">data= data)</span>
<span class="s2">plt.setp(ax.artists</span><span class="s1">, </span><span class="s2">alpha=</span><span class="s4">.5</span><span class="s1">, </span><span class="s2">linewidth=</span><span class="s4">2</span><span class="s1">, </span><span class="s2">edgecolor=</span><span class="s3">&quot;k&quot;</span><span class="s2">)</span>
<span class="s2">plt.xticks(rotation=</span><span class="s4">45</span><span class="s2">)</span>
<span class="s0">#%% md 
</span><span class="s2">## Categorical data 
 
</span><span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_ENROLES'</span><span class="s2">].unique()</span>
<span class="s0">#%% md 
</span>
<span class="s0">#%% md 
</span><span class="s2">The feature 'CLIENT_ENROLES' contains three attributes FALSE NON TRUE 
</span><span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_ENROLES'</span><span class="s2">].replace(</span><span class="s3">'NON'</span><span class="s1">,</span><span class="s3">'FALSE'</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_ENROLES'</span><span class="s2">].value_counts()</span>
<span class="s0">#%% 
</span><span class="s2">data.CLIENT_ENROLES.value_counts().plot(kind=</span><span class="s3">&quot;bar&quot; </span><span class="s1">, </span><span class="s2">color=[</span><span class="s3">'pink'</span><span class="s1">,</span><span class="s3">'olive'</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">&quot;Distribution of client's enrolement to remote services&quot;</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s2">--&gt; Most of the clients are not enrolled to the remote services so the column can be removed 
</span><span class="s0">#%% 
</span><span class="s2">data=data.drop(columns = [</span><span class="s3">'CLIENT_ENROLES'</span><span class="s2">])</span>

<span class="s0">#%% 
#Client's seniority</span>

<span class="s2">data.CLIENT_ENTREE_FINAL.value_counts().plot(kind=</span><span class="s3">&quot;bar&quot; </span><span class="s1">, </span><span class="s2">color=[</span><span class="s3">'pink'</span><span class="s1">,</span><span class="s3">'olive'</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">&quot;Distribution of the seniority of the clients&quot;</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">len(data[data[</span><span class="s3">'CLIENT_ENTREE_FINAL'</span><span class="s2">]==</span><span class="s3">'CONQUETE'</span><span class="s2">])</span>

<span class="s0">#%% 
</span><span class="s2">len(data[data[</span><span class="s3">'CLIENT_ENTREE_FINAL'</span><span class="s2">]==</span><span class="s3">'AUTRE'</span><span class="s2">])</span>

<span class="s0">#%% 
</span><span class="s2">data = data.drop(columns=</span><span class="s3">'CLIENT_ENTREE_FINAL'</span><span class="s2">)</span>
<span class="s0">#%% 
#Analyzing Segment feature</span>
<span class="s2">data[</span><span class="s3">'SEGMENT'</span><span class="s2">].unique()</span>
<span class="s0">#%% 
</span>
<span class="s0">#working only with these four segments 'CLASSE MOYENNE', 'GRAND PUBLIC', 'HAUT DE GAMME', 'JEUNES'</span>
<span class="s2">data.drop(data[data[</span><span class="s3">'SEGMENT'</span><span class="s2">] == </span><span class="s3">'XXX'</span><span class="s2">].index</span><span class="s1">, </span><span class="s2">inplace = </span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data.drop(data[data[</span><span class="s3">'SEGMENT'</span><span class="s2">] == </span><span class="s3">'TRE'</span><span class="s2">].index</span><span class="s1">, </span><span class="s2">inplace = </span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data.drop(data[data[</span><span class="s3">'SEGMENT'</span><span class="s2">] == </span><span class="s3">'ENR'</span><span class="s2">].index</span><span class="s1">, </span><span class="s2">inplace = </span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data.drop(data[data[</span><span class="s3">'SEGMENT'</span><span class="s2">] == </span><span class="s3">'AUTRES'</span><span class="s2">].index</span><span class="s1">, </span><span class="s2">inplace = </span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'SEGMENT'</span><span class="s2">].unique()</span>
<span class="s0">#%% 
</span>
<span class="s2">data[</span><span class="s3">'SEGMENT'</span><span class="s2">].value_counts()</span>

<span class="s0">#%% 
#Visualizing segments</span>
<span class="s2">labels = [</span><span class="s3">'GRAND PUBLIC '</span><span class="s1">, </span><span class="s3">'CLASSE MOYENNE'</span><span class="s1">,</span><span class="s3">'HAUT DE GAMME'</span><span class="s1">,</span><span class="s3">'JEUNES'</span><span class="s2">]</span>
<span class="s2">size = [</span><span class="s4">297934</span><span class="s1">, </span><span class="s4">242402 </span><span class="s1">, </span><span class="s4">152200 </span><span class="s1">,</span><span class="s4">51405 </span><span class="s2">]</span>
<span class="s2">colors = [</span><span class="s3">'lightgreen'</span><span class="s1">, </span><span class="s3">'orange'</span><span class="s1">,</span><span class="s3">'cyan'</span><span class="s1">,</span><span class="s3">'pink'</span><span class="s2">]</span>
<span class="s2">explode = </span><span class="s1">None</span>

<span class="s2">plt.rcParams[</span><span class="s3">'figure.figsize'</span><span class="s2">] = (</span><span class="s4">7</span><span class="s1">, </span><span class="s4">7</span><span class="s2">)</span>
<span class="s2">plt.pie(size</span><span class="s1">, </span><span class="s2">colors = colors</span><span class="s1">, </span><span class="s2">explode = explode</span><span class="s1">, </span><span class="s2">labels = labels</span><span class="s1">, </span><span class="s2">shadow = </span><span class="s1">True, </span><span class="s2">autopct = </span><span class="s3">'%.2f%%'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'A pie chart Representing the segments'</span><span class="s2">)</span>
<span class="s2">plt.axis(</span><span class="s3">'off'</span><span class="s2">)</span>
<span class="s2">plt.legend()</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].unique()</span>

<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_ACTIVITE'</span><span class="s2">].unique()</span>
<span class="s0">#%% md 
</span><span class="s2">The columns 'CLIENT_ACTIVITE' and 'CLIENT_PROFESSION' both refer to same thing. Only the cloumn 'CLIENT_PROFESSION' will be used 
</span><span class="s0">#%% 
</span><span class="s2">data=data.drop(columns = [</span><span class="s3">'CLIENT_ACTIVITE'</span><span class="s2">])</span>

<span class="s0">#%% 
</span><span class="s2">data.CLIENT_PROFESSION.value_counts()[:</span><span class="s4">10</span><span class="s2">].plot(kind=</span><span class="s3">'bar'</span><span class="s2">)</span>

<span class="s0">#%% md 
</span><span class="s2">The majority of the clients do not have a job 
Also the professions will be categorized and corrected. 
</span><span class="s0">#%% 
#Cadre sup</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Autres cadres supÃ©rieurs&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre supérieur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Cadres supÃ©rieurs des services administratifs et financiers&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre supérieur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Cadres supÃ©rieurs dans l'industrie&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre supérieur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Hauts fonctionnaires de l'administration publique&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre supérieur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Chefs de mission diplomatique et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre supérieur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s0">#Cadre moy</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Cadres moyens dans les autres services&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre moyen&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Cadres moyens dans l'administration publique&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre moyen&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Cadres moyens dans l'industrie&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre moyen&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Cadres moyens des services administratifs et financiers&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre moyen&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Cadres moyens dans l'administration publique&quot;</span><span class="s1">, </span><span class="s3">&quot;Cadre moyen&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Justice</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Huissiers de justice, notaires, experts judiciaires et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur de la justice&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Membres de l'exÃ©cutif et du corps lÃ©gislatif&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur de la justice&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Magistrats&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur de la justice&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Avocats&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur de la justice&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Employés de bureau</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;EmployÃ©s de bureau&quot;</span><span class="s1">, </span><span class="s3">&quot;Employés de bureau&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;SecrÃ©taires, opÃ©rateurs de traitement de texte et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Employé de bureau&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Retraités</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;RetraitÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Retraités&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>



<span class="s0">#Santé</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MÃ©decins de la fonction publique et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en santé&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MÃ©decins gÃ©nÃ©ralistes&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en santé&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MÃ©decins spÃ©cialistes&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en santé&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MÃ©decins dentistes&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en santé&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MÃ©decins vÃ©tÃ©rinaires&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en santé&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Pharmaciens&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en santé &quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MÃ©decins&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en santé &quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0"># para</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Opticiens-lunetiers&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en para-médicales&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Professions para-mÃ©dicales&quot;</span><span class="s1">, </span><span class="s3">&quot;Professionnel en para-médicales&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>


<span class="s0">#Dirigeant</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Dirigeants et gÃ©rants dans l'industrie&quot;</span><span class="s1">, </span><span class="s3">&quot;Dirigeant et gérant &quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Dirigeants et gÃ©rants dans le tourisme, la restauration et l'hotellerie&quot;</span><span class="s1">, </span><span class="s3">&quot;Dirigeant et gérant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Dirigeants et gÃ©rants dans le transport&quot;</span><span class="s1">, </span><span class="s3">&quot;Dirigeant et gérant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Dirigeants et gÃ©rants dans l'agriculture et la pÃªche&quot;</span><span class="s1">, </span><span class="s3">&quot;Dirigeant et gérant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Dirigeants et gÃ©rants dans les services&quot;</span><span class="s1">, </span><span class="s3">&quot;Dirigeant et gérant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Ingénieur</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;IngÃ©nieurs&quot;</span><span class="s1">, </span><span class="s3">&quot;Ingénieurs&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Technicien</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Techniciens (autres)&quot;</span><span class="s1">, </span><span class="s3">&quot;Technicien&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Techniciens en batiment et travaux publics&quot;</span><span class="s1">, </span><span class="s3">&quot;Technicien&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Techniciens en informatique et nouvelles technologies&quot;</span><span class="s1">, </span><span class="s3">&quot;Technicien&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Techniciens de laboratoire&quot;</span><span class="s1">, </span><span class="s3">&quot;Technicien&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>


<span class="s0">#Ouvrier</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Ouvriers des mÃ©tiers d'artisanat&quot;</span><span class="s1">, </span><span class="s3">&quot;Ouvrier&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Ouvriers dans autres secteurs&quot;</span><span class="s1">, </span><span class="s3">&quot;Ouvrier&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Ouvriers dans l'industrie&quot;</span><span class="s1">, </span><span class="s3">&quot;Ouvrier&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Ouvriers agricoles&quot;</span><span class="s1">, </span><span class="s3">&quot;Ouvrier&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Scientifique</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;SpÃ©cialistes scientifiques&quot;</span><span class="s1">, </span><span class="s3">&quot;Spécialiste scientifique&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Biologistes et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Spécialiste scientifique&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s0">#Prestataire de services</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Coiffeurs, esthÃ©ticiens et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Prestataire de services&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Courtiers&quot;</span><span class="s1">, </span><span class="s3">&quot;Prestataire de services&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Autres prestataires de service&quot;</span><span class="s1">, </span><span class="s3">&quot;Prestataire de services&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Acteur en bâtiment travaux publics</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MaÃ§ons et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en bâtiment travaux publics&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Electriciens&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en bâtiment travaux publics&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;MÃ©caniciens&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en bâtiment travaux publics&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Conducteurs dans le batiment et travaux publics&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en bâtiment travaux publics&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Plombiers&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en bâtiment travaux publics&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Architectes et urbanistes&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en bâtiment travaux publics&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Menuisiers&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en bâtiment travaux publics&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Consultant</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Conseillers et consultants&quot;</span><span class="s1">, </span><span class="s3">&quot;Conseiller et consultant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Experts-comptables&quot;</span><span class="s1">, </span><span class="s3">&quot;Conseiller et consultant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Service défense sécurité</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Forces ArmÃ©es&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en service de défense/sécurité&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>


<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Agents de la force publique&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en service de défense/sécurité&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Pilotes et officiers de pont&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur en service de défense/sécurité&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Artisan</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Artisans dans la restauration, l'alimentation et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Artisan&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Artisans du batiment et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Artisan&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Artisans du textile, de l'habillement et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Artisan&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Artisans dans l'imprimerie et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Artisan&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Artisans du bois et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Artisan&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Artisans du cuir et de la chaussure&quot;</span><span class="s1">, </span><span class="s3">&quot;Artisan&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Artisans (autres)&quot;</span><span class="s1">, </span><span class="s3">&quot;Artisan&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Commerçant</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;CommerÃ§ants (autres)&quot;</span><span class="s1">, </span><span class="s3">&quot;Commerçant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;CommerÃ§ants dans l'alimentation gÃ©nÃ©rale&quot;</span><span class="s1">, </span><span class="s3">&quot;Commerçant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;CommerÃ§ants dans l'entretien et rÃ©paration&quot;</span><span class="s1">, </span><span class="s3">&quot;Commerçant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;CommerÃ§ants dans l'habillement et la chaussure&quot;</span><span class="s1">, </span><span class="s3">&quot;Commerçant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;CommerÃ§ants dans le tourisme, loisirs et restauration&quot;</span><span class="s1">, </span><span class="s3">&quot;Commerçant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;CommerÃ§ants dans l'ameublement, appareils Ã©lectro mÃ©nager et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Commerçant&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>



<span class="s0">#Education</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Inspecteur pÃ©dagogique&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur dans le secteur d'éducation&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Directeurs d'Ã©tablissements d'enseignement et de formation, et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur dans le secteur d'éducation&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Enseignants de l'enseignement primaire&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur dans le secteur d'éducation&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Enseignants universitaires&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur dans le secteur d'éducation&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Enseignants de l'enseignement secondaire&quot;</span><span class="s1">, </span><span class="s3">&quot;Acteur dans le secteur d'éducation&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Agriculture</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;PÃªcheurs&quot;</span><span class="s1">, </span><span class="s3">&quot;Agriculteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Eleveurs&quot;</span><span class="s1">, </span><span class="s3">&quot;Agriculteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Agriculteurs&quot;</span><span class="s1">, </span><span class="s3">&quot;Agriculteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">#Conducteurs</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Conducteurs dans le transport de marchandises&quot;</span><span class="s1">, </span><span class="s3">&quot;Conducteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Chauffeurs de taxis et conducteurs d'automobiles et de camionnettes&quot;</span><span class="s1">, </span><span class="s3">&quot;Conducteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Conducteurs d'engins agricoles&quot;</span><span class="s1">, </span><span class="s3">&quot;Conducteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Conducteurs dans le transport public&quot;</span><span class="s1">, </span><span class="s3">&quot;Conducteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Conducteurs d'engins agricoles&quot;</span><span class="s1">, </span><span class="s3">&quot;Conducteur&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Etudiants&quot;</span><span class="s1">, </span><span class="s3">&quot;Étudiants&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Sportifs et assimilÃ©s&quot;</span><span class="s1">, </span><span class="s3">&quot;Sportifs et assimilés&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>



<span class="s0">#Agent</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Agents d'accueil, de sÃ©curitÃ© et de nettoyage&quot;</span><span class="s1">, </span><span class="s3">&quot;Agent&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Agents&quot;</span><span class="s1">, </span><span class="s3">&quot;Agent&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;Transitaires et commissionnaires&quot;</span><span class="s1">, </span><span class="s3">&quot;Agent&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].replace(</span><span class="s3">&quot;ElÃ¨ves&quot;</span><span class="s1">, </span><span class="s3">&quot;Élèves&quot;</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>



<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].unique()</span>
<span class="s0">#%% 
# Replace the &quot;unknow&quot; Category with the Mode value</span>
<span class="s2">data.CLIENT_PROFESSION.replace(</span><span class="s3">&quot;N_D&quot;</span><span class="s1">,</span><span class="s2">data.CLIENT_PROFESSION.mode() [</span><span class="s4">0</span><span class="s2">]</span><span class="s1">,</span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">].unique()</span>
<span class="s0">#%% 
#create a fuction to explore the categorical variables</span>

<span class="s1">def </span><span class="s2">plot(attribute_category):</span>
    <span class="s2">attribute_category.value_counts().plot(kind=</span><span class="s3">&quot;bar&quot;</span><span class="s2">)</span>
    <span class="s2">plt.title(</span><span class="s3">&quot;attribute distribution&quot;</span><span class="s2">)</span>
    <span class="s2">plt.show()</span>
    <span class="s2">print(</span><span class="s3">&quot;</span><span class="s1">\n</span><span class="s3">&quot;</span><span class="s2">)</span>

    <span class="s2">pd.crosstab(attribute_category</span><span class="s1">,</span><span class="s2">data.SEGMENT).T.plot(kind=</span><span class="s3">&quot;bar&quot;</span><span class="s1">,</span><span class="s2">stacked = </span><span class="s1">True</span><span class="s2">)</span>
    <span class="s2">plt.legend(bbox_to_anchor=(</span><span class="s4">1.0</span><span class="s1">, </span><span class="s4">0.5</span><span class="s2">))</span>
    <span class="s2">plt.title(</span><span class="s3">&quot;The ratio of  attribute category to y category (yes/no)&quot;</span><span class="s2">)</span>
    <span class="s2">plt.show()</span>
    <span class="s2">print(</span><span class="s3">&quot;[Each column sums up to 1] &quot;</span><span class="s2">)</span>
    <span class="s2">print (pd.crosstab(attribute_category</span><span class="s1">,</span><span class="s2">data.SEGMENT</span><span class="s1">,</span><span class="s2">normalize=</span><span class="s3">&quot;columns&quot;</span><span class="s2">))</span>
    <span class="s2">print(</span><span class="s3">&quot;</span><span class="s1">\n\n\n</span><span class="s3">&quot;</span><span class="s2">)</span>

    <span class="s2">pd.crosstab(attribute_category</span><span class="s1">,</span><span class="s2">data.SEGMENT).plot(kind=</span><span class="s3">&quot;bar&quot;</span><span class="s1">,</span><span class="s2">stacked = </span><span class="s1">True</span><span class="s2">)</span>
    <span class="s2">plt.title(</span><span class="s3">&quot;The ratio of y category (yes/no) to attribute category&quot;</span><span class="s2">)</span>
    <span class="s2">plt.show()</span>
    <span class="s2">print(</span><span class="s3">&quot;[Each row sums up to 1]&quot;</span><span class="s2">)</span>
    <span class="s2">print (pd.crosstab(attribute_category</span><span class="s1">,</span><span class="s2">data.SEGMENT</span><span class="s1">,</span><span class="s2">normalize=</span><span class="s3">&quot;index&quot;</span><span class="s2">))</span>
<span class="s0">#%% 
</span><span class="s2">plot(data.CLIENT_PROFESSION)</span>
<span class="s0">#%% 
</span><span class="s2">data.CLIENT_TYPE_DEPOSANT.value_counts().plot(kind=</span><span class="s3">&quot;bar&quot; </span><span class="s1">, </span><span class="s2">color=[</span><span class="s3">'orange'</span><span class="s1">, </span><span class="s3">'pink'</span><span class="s1">, </span><span class="s3">'cyan'</span><span class="s1">, </span><span class="s3">'olive'</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">&quot; Deposit type distribution&quot;</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_TYPE_DEPOSANT'</span><span class="s2">].value_counts()</span>
<span class="s0">#%% 
</span><span class="s2">plot(data.CLIENT_TYPE_DEPOSANT)</span>
<span class="s0">#%% 
</span><span class="s2">plot(data[</span><span class="s3">'SOUS SEGMENT'</span><span class="s2">])</span>

<span class="s0">#%% 
</span><span class="s2">data.AGENCE.value_counts()[:</span><span class="s4">10</span><span class="s2">].plot(kind=</span><span class="s3">'bar'</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'AGENCE'</span><span class="s2">].unique()</span>

<span class="s0">#%% 
</span><span class="s2">data.MARCHE.value_counts()[:</span><span class="s4">10</span><span class="s2">].plot(kind=</span><span class="s3">'bar'</span><span class="s2">)</span>

<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'MARCHE'</span><span class="s2">].unique()</span>

<span class="s0">#%% 
</span><span class="s2">data[data[</span><span class="s3">'MARCHE'</span><span class="s2">] == </span><span class="s3">'PART'</span><span class="s2">]</span>
<span class="s0">#%% md 
</span><span class="s2">### Data Reduction 
</span><span class="s0">#%% 
#Dropping Agence and marche</span>
<span class="s2">data = data.drop(columns= [</span><span class="s3">'AGENCE'</span><span class="s1">,</span><span class="s3">'MARCHE'</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_REVENUS_MENSUELS_NETS'</span><span class="s2">].describe()</span>

<span class="s0">#%% 
</span><span class="s2">data = data.drop(columns= [</span><span class="s3">'CLIENT_ENCOURS_A_VUE'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_BIATNET'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_OPCVM'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_TITRES'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_PROJET_AVENIR'</span><span class="s1">,</span><span class="s3">'CLIENT_ID'</span><span class="s2">])</span>
<span class="s0">#%% md 
</span><span class="s2">### Features relationship Analysis 
</span><span class="s0">#%% 
</span><span class="s2">correlation = data.corr()</span>
<span class="s2">correlation</span>
<span class="s2">plt.figure(figsize=(</span><span class="s4">50</span><span class="s1">,</span><span class="s4">50</span><span class="s2">))</span>
<span class="s2">sns.heatmap(correlation</span><span class="s1">, </span><span class="s2">xticklabels=correlation.columns </span><span class="s1">, </span><span class="s2">yticklabels=correlation.columns </span><span class="s1">, </span><span class="s2">annot=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">plt.savefig(</span><span class="s3">'figure1.png'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">50</span><span class="s1">, </span><span class="s2">(</span><span class="s4">50</span><span class="s2">)))</span>

<span class="s2">sns.heatmap(correlation[(correlation &gt;= </span><span class="s4">0.5</span><span class="s2">) | (correlation &lt;= -</span><span class="s4">0.4</span><span class="s2">)]</span><span class="s1">,</span>
            <span class="s2">cmap=</span><span class="s3">'viridis'</span><span class="s1">, </span><span class="s2">vmax=</span><span class="s4">1.0</span><span class="s1">, </span><span class="s2">vmin=-</span><span class="s4">1.0</span><span class="s1">, </span><span class="s2">linewidths=</span><span class="s4">0.1</span><span class="s1">,</span>
            <span class="s2">annot=</span><span class="s1">True, </span><span class="s2">annot_kws={</span><span class="s3">&quot;size&quot;</span><span class="s2">: </span><span class="s4">8</span><span class="s2">}</span><span class="s1">, </span><span class="s2">square=</span><span class="s1">True</span><span class="s2">);</span>
<span class="s0">#%% 
</span><span class="s2">sns.catplot(x=</span><span class="s3">&quot;SEGMENT&quot;</span><span class="s1">, </span><span class="s2">y=</span><span class="s3">&quot;CLIENT_MMM&quot;</span><span class="s1">, </span><span class="s2">data=data </span><span class="s1">, </span><span class="s2">height=</span><span class="s4">6</span><span class="s1">, </span><span class="s2">aspect=</span><span class="s4">11.7</span><span class="s2">/</span><span class="s4">6</span><span class="s2">);</span>
<span class="s0">#%% 
</span><span class="s2">sns.catplot(x=</span><span class="s3">&quot;SEGMENT&quot;</span><span class="s1">, </span><span class="s2">y=</span><span class="s3">&quot;CLIENT_VRD_MOY&quot;</span><span class="s1">, </span><span class="s2">data=data </span><span class="s1">, </span><span class="s2">height=</span><span class="s4">6</span><span class="s1">, </span><span class="s2">aspect=</span><span class="s4">11.7</span><span class="s2">/</span><span class="s4">6</span><span class="s2">);</span>
<span class="s0">#%% 
</span><span class="s2">fig</span><span class="s1">, </span><span class="s2">axarr = plt.subplots(</span><span class="s4">3</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s2">figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">18</span><span class="s2">))</span>
<span class="s2">data.groupby(</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">)[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">].mean().sort_values(ascending=</span><span class="s1">False</span><span class="s2">).plot.bar(ax=axarr[</span><span class="s4">0</span><span class="s2">][</span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">12</span><span class="s2">)</span>
<span class="s2">axarr[</span><span class="s4">0</span><span class="s2">][</span><span class="s4">0</span><span class="s2">].set_title(</span><span class="s3">&quot;AGE Vs PROFESSION&quot;</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>

<span class="s2">data.groupby(</span><span class="s3">'CLIENT_TYPE_DEPOSANT'</span><span class="s2">)[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">].mean().sort_values(ascending=</span><span class="s1">False</span><span class="s2">).plot.bar(ax=axarr[</span><span class="s4">0</span><span class="s2">][</span><span class="s4">1</span><span class="s2">]</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">12</span><span class="s2">)</span>
<span class="s2">axarr[</span><span class="s4">0</span><span class="s2">][</span><span class="s4">1</span><span class="s2">].set_title(</span><span class="s3">&quot;AGE Vs DEPOSIT TYPE&quot;</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>

<span class="s2">data.groupby(</span><span class="s3">'SEGMENT'</span><span class="s2">)[</span><span class="s3">'TOTAL_PACK'</span><span class="s2">].mean().sort_values(ascending=</span><span class="s1">False</span><span class="s2">).plot.bar(ax=axarr[</span><span class="s4">1</span><span class="s2">][</span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">12</span><span class="s2">)</span>
<span class="s2">axarr[</span><span class="s4">1</span><span class="s2">][</span><span class="s4">0</span><span class="s2">].set_title(</span><span class="s3">&quot;TOTAL PACKS Vs SEGMENT&quot;</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>

<span class="s2">data.groupby(</span><span class="s3">'PACK'</span><span class="s2">)[</span><span class="s3">'CLIENT_NOMBRE_CARTES'</span><span class="s2">].mean().sort_values(ascending=</span><span class="s1">False</span><span class="s2">).plot.bar(ax=axarr[</span><span class="s4">1</span><span class="s2">][</span><span class="s4">1</span><span class="s2">]</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">12</span><span class="s2">)</span>
<span class="s2">axarr[</span><span class="s4">1</span><span class="s2">][</span><span class="s4">1</span><span class="s2">].set_title(</span><span class="s3">&quot;CARD NUMBER Vs PACK MEMBERSHIP&quot;</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>

<span class="s2">data.groupby(</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">)[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">].mean().sort_values(ascending=</span><span class="s1">False</span><span class="s2">).plot.bar(ax=axarr[</span><span class="s4">2</span><span class="s2">][</span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">12</span><span class="s2">)</span>
<span class="s2">axarr[</span><span class="s4">2</span><span class="s2">][</span><span class="s4">0</span><span class="s2">].set_title(</span><span class="s3">&quot;PROFESSION Vs VRD&quot;</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>

<span class="s2">data.groupby(</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">)[</span><span class="s3">'CLIENT_MMM'</span><span class="s2">].mean().sort_values(ascending=</span><span class="s1">False</span><span class="s2">).plot.bar(ax=axarr[</span><span class="s4">2</span><span class="s2">][</span><span class="s4">1</span><span class="s2">]</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">12</span><span class="s2">)</span>
<span class="s2">axarr[</span><span class="s4">2</span><span class="s2">][</span><span class="s4">1</span><span class="s2">].set_title(</span><span class="s3">&quot;PROFESSION Vs MMM&quot;</span><span class="s1">, </span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>

<span class="s2">plt.subplots_adjust(hspace=</span><span class="s4">2.0</span><span class="s2">)</span>
<span class="s2">plt.subplots_adjust(wspace=</span><span class="s4">.5</span><span class="s2">)</span>
<span class="s2">sns.despine()</span>
<span class="s0">#%% 
</span><span class="s2">sns.boxplot(x=</span><span class="s3">'SEGMENT'</span><span class="s1">, </span><span class="s2">y=</span><span class="s3">'CLIENT_AGE'</span><span class="s1">, </span><span class="s2">data=data)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_NOMBRE_CARTES'</span><span class="s2">].unique()</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s3">'CLIENT_MMM'</span><span class="s2">].describe()</span>
<span class="s0">#%% 
</span><span class="s2">data.shape</span>
<span class="s0">#%% 
</span><span class="s2">data = data.drop(columns= [</span><span class="s3">'SEGMENT'</span><span class="s1">,</span><span class="s3">'SOUS SEGMENT'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_MESSAGIS'</span><span class="s1">,</span><span class="s3">'CLIENT_NOMBRE_FAMILIA'</span><span class="s1">,</span><span class="s3">'CLIENT_REVENUS_MENSUELS_NETS'</span><span class="s1">,</span><span class="s3">'VALEUR'</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">data</span>
<span class="s0">#%% md 
</span>
<span class="s0">#%% md 
</span>
<span class="s0">#%% md 
</span><span class="s2"># Feature scaling 
For instance, Feature Scaling doesn't do much if the scale doesn't matter. For K-Means Clustering, the Euclidean distance is important, so Feature Scaling makes a huge impact. 
</span><span class="s0">#%% md 
</span><span class="s2">### Label encoding using OneHotEncoder 
</span><span class="s0">#%% 
</span>
<span class="s2">one_hot_encoded_data = pd.get_dummies(data</span><span class="s1">, </span><span class="s2">columns = [</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s1">, </span><span class="s3">'CLIENT_TYPE_DEPOSANT'</span><span class="s1">,</span><span class="s3">'PACK'</span><span class="s2">])</span>
<span class="s2">one_hot_encoded_data</span>
<span class="s0">#%% md 
</span><span class="s2">### Standarize the data 
StandardScaler is useful for the features that follow a Normal distribution.Therefore, it makes mean = 0 and scales the data to unit variance. 
MinMaxScaler may be used when the upper and lower boundaries are well known from domain knowledge 
</span><span class="s0">#%% 
#Define standardscaler</span>
<span class="s2">scaler = StandardScaler()</span>

<span class="s0">#Transform data</span>

<span class="s2">scaled = scaler.fit_transform(one_hot_encoded_data)</span>
<span class="s2">print(scaled)</span>
<span class="s0">#%% 
</span>
<span class="s0">#%% 
</span><span class="s1">from </span><span class="s2">sklearn.decomposition </span><span class="s1">import </span><span class="s2">PCA</span>

<span class="s0">#fitting the pca algorithm with our data</span>
<span class="s2">pca = PCA().fit(scaled)</span>
<span class="s0">#plotting the cumulative summation of the explained variance</span>
<span class="s2">plt.figure()</span>
<span class="s2">plt.plot(np.cumsum(pca.explained_variance_ratio_))</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Number of components'</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Variance % for each components'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Explained variance'</span><span class="s2">)</span>
<span class="s0"># Set the range of x-axis</span>
<span class="s2">plt.xlim(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">10</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">data.columns</span>
<span class="s0">#%% 
</span><span class="s2">X= data.iloc[:</span><span class="s1">, </span><span class="s2">[</span><span class="s4">0</span><span class="s1">,</span><span class="s4">6</span><span class="s2">]].values</span>
<span class="s2">X</span>
<span class="s0">#%% 
</span><span class="s2">X = scaler.fit_transform(X)</span>
<span class="s2">print(X)</span>
<span class="s0">#%% md 
</span><span class="s2">### K-means Clustering 
</span><span class="s0">#%% 
#Building the Model</span>
<span class="s0">#KMeans Algorithm to decide the optimum cluster number , KMeans++ using Elbow Mmethod</span>
<span class="s0">#to figure out K for KMeans, I will use ELBOW Method on KMEANS++ Calculation</span>
<span class="s2">wcss=[]</span>

<span class="s0">#we always assume the max number of cluster would be 10</span>
<span class="s0">#you can judge the number of clusters by doing averaging</span>
<span class="s0">###Static code to get max no of clusters</span>

<span class="s1">for </span><span class="s2">i </span><span class="s1">in </span><span class="s2">range(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">11</span><span class="s2">):</span>
    <span class="s2">kmeans = KMeans(n_clusters= i</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">kmeans.fit(X)</span>
    <span class="s2">wcss.append(kmeans.inertia_)</span>

    <span class="s0">#inertia_ is the formula used to segregate the data points into clusters</span>
<span class="s0">#%% 
#Visualizing the ELBOW method to get the optimal value of K</span>
<span class="s2">plt.plot(range(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">11</span><span class="s2">)</span><span class="s1">, </span><span class="s2">wcss)</span>
<span class="s2">plt.title(</span><span class="s3">'The Elbow Method'</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'no of clusters'</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'wcss'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
#For unsupervised learning we use &quot;fit_predict()&quot; wherein for supervised learning we use &quot;fit_tranform()&quot;</span>
<span class="s0">#y_kmeans is the final model . Now how and where we will deploy this model in production is depends on what tool we are using.</span>
<span class="s0">#This use case is very common and it is used in BFS industry(credit card) and retail for customer segmenattion.</span>

<span class="s2">kmeans = KMeans(n_clusters = </span><span class="s4">4</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">0</span><span class="s2">)</span>
<span class="s2">y_kmeans = kmeans.fit_predict(X)</span>
<span class="s2">u_labels = np.unique(y_kmeans)</span>
<span class="s0">#%% 
</span><span class="s2">sns.countplot(y_kmeans)</span>

<span class="s0">#%% 
</span><span class="s1">for </span><span class="s2">i </span><span class="s1">in </span><span class="s2">u_labels:</span>
    <span class="s2">plt.scatter(X[y_kmeans == i </span><span class="s1">, </span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">X[y_kmeans == i </span><span class="s1">, </span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">label = i)</span>
<span class="s2">plt.legend()</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.scatter(X[:</span><span class="s1">, </span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">X[:</span><span class="s1">, </span><span class="s4">1</span><span class="s2">]</span><span class="s1">, </span><span class="s2">c=y_kmeans</span><span class="s1">, </span><span class="s2">s=</span><span class="s4">50</span><span class="s1">, </span><span class="s2">cmap=</span><span class="s3">'viridis'</span><span class="s2">)</span>

<span class="s2">centers = kmeans.cluster_centers_</span>
<span class="s2">plt.scatter(centers[:</span><span class="s1">, </span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">centers[:</span><span class="s1">, </span><span class="s4">1</span><span class="s2">]</span><span class="s1">, </span><span class="s2">c=</span><span class="s3">'black'</span><span class="s1">, </span><span class="s2">s=</span><span class="s4">200</span><span class="s1">, </span><span class="s2">alpha=</span><span class="s4">0.5</span><span class="s2">);</span>
<span class="s0">#%% 
</span>
<span class="s0">#%% 
</span><span class="s2">df_customers_kmeans = data.copy()</span>
<span class="s2">df_customers_kmeans[</span><span class="s3">'Segment'</span><span class="s2">] = kmeans.labels_  </span><span class="s0"># It will contain the predicted clusters for each observation in our data set</span>
<span class="s2">df_customers_kmeans</span>
<span class="s0">#%% 
</span><span class="s2">df_customers_analysis = df_customers_kmeans.groupby(</span><span class="s3">'Segment'</span><span class="s2">).mean().round(</span><span class="s4">3</span><span class="s2">)</span>
<span class="s2">df_customers_analysis</span>
<span class="s0">#%% 
</span><span class="s2">df_customers_analysis[</span><span class="s3">'Count'</span><span class="s2">] = df_customers_kmeans[[</span><span class="s3">'Segment'</span><span class="s1">, </span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">]].groupby(</span><span class="s3">'Segment'</span><span class="s2">).count()</span>
<span class="s2">df_customers_analysis[</span><span class="s3">'%'</span><span class="s2">] = df_customers_analysis[</span><span class="s3">'Count'</span><span class="s2">] / df_customers_analysis[</span><span class="s3">'Count'</span><span class="s2">].sum()</span>
<span class="s2">df_customers_analysis.rename(index={</span>
    <span class="s4">0</span><span class="s2">: </span><span class="s3">'CLASSE MOYENNE'</span><span class="s1">,</span>
    <span class="s4">1</span><span class="s2">: </span><span class="s3">'GRAND PUBLIC'</span><span class="s1">,</span>
    <span class="s4">2</span><span class="s2">: </span><span class="s3">'HAUT DE GAMME'</span><span class="s1">,</span>
    <span class="s4">3</span><span class="s2">: </span><span class="s3">'JEUNES'</span>
<span class="s2">}</span><span class="s1">, </span><span class="s2">inplace=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">df_customers_analysis</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">8</span><span class="s1">, </span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">s = sns.barplot(data=df_customers_analysis</span><span class="s1">, </span><span class="s2">x=df_customers_analysis.index</span><span class="s1">, </span><span class="s2">y=</span><span class="s3">'Count'</span><span class="s1">, </span><span class="s2">palette=[</span><span class="s3">'g'</span><span class="s1">,</span><span class="s3">'c'</span><span class="s1">,</span><span class="s3">'r'</span><span class="s1">,</span><span class="s3">'m'</span><span class="s2">])</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Segment'</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Population'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">df_customers_kmeans[</span><span class="s3">'Segment'</span><span class="s2">] = df_customers_kmeans[</span><span class="s3">'Segment'</span><span class="s2">].map({</span>
    <span class="s4">0</span><span class="s2">: </span><span class="s3">'CLASSE MOYENNE'</span><span class="s1">,</span>
    <span class="s4">1</span><span class="s2">: </span><span class="s3">'GRAND PUBLIC'</span><span class="s1">,</span>
    <span class="s4">2</span><span class="s2">: </span><span class="s3">'HAUT DE GAMME'</span><span class="s1">,</span>
    <span class="s4">3</span><span class="s2">: </span><span class="s3">'JEUNES'</span>
<span class="s2">})</span>
<span class="s2">df_customers_kmeans</span>
<span class="s0">#%% 
#Getting the Centroids</span>
<span class="s2">centroids = kmeans.cluster_centers_</span>
<span class="s2">u_labels = np.unique(y_kmeans)</span>
<span class="s0">#%% 
#plotting the results:</span>

<span class="s1">for </span><span class="s2">i </span><span class="s1">in </span><span class="s2">u_labels:</span>
    <span class="s2">plt.scatter(X[y_kmeans == i </span><span class="s1">, </span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">X[y_kmeans == i </span><span class="s1">, </span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">label = i)</span>
    <span class="s2">plt.scatter(centroids[:</span><span class="s1">,</span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">centroids[:</span><span class="s1">,</span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">s = </span><span class="s4">80</span><span class="s1">, </span><span class="s2">color = </span><span class="s3">'k'</span><span class="s2">)</span>
<span class="s2">plt.legend()</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
#filter rows of original data</span>
<span class="s2">filtered_label0 = X[y_kmeans == </span><span class="s4">0</span><span class="s2">]</span>
<span class="s2">filtered_label1 = X[y_kmeans == </span><span class="s4">1</span><span class="s2">]</span>
<span class="s2">filtered_label2 = X[y_kmeans == </span><span class="s4">2</span><span class="s2">]</span>
<span class="s2">filtered_label3= X[y_kmeans == </span><span class="s4">3</span><span class="s2">]</span>
<span class="s2">filtered_label4 = X[y_kmeans == </span><span class="s4">4</span><span class="s2">]</span>

<span class="s0">#plotting the results</span>
<span class="s2">fig = plt.figure(figsize = (</span><span class="s4">15</span><span class="s1">,</span><span class="s4">15</span><span class="s2">))</span>
<span class="s2">ax = fig.add_subplot(</span><span class="s4">111</span><span class="s1">, </span><span class="s2">projection=</span><span class="s3">'3d'</span><span class="s2">)</span>
<span class="s2">ax.scatter(filtered_label0[:</span><span class="s1">,</span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">filtered_label0[:</span><span class="s1">,</span><span class="s4">1</span><span class="s2">])</span>
<span class="s2">ax.scatter(filtered_label1[:</span><span class="s1">,</span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">filtered_label1[:</span><span class="s1">,</span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">color = </span><span class="s3">'orange'</span><span class="s2">)</span>
<span class="s2">ax.scatter(filtered_label2[:</span><span class="s1">,</span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">filtered_label2[:</span><span class="s1">,</span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">color = </span><span class="s3">'cyan'</span><span class="s2">)</span>
<span class="s2">ax.scatter(filtered_label3[:</span><span class="s1">,</span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">filtered_label3[:</span><span class="s1">,</span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">color = </span><span class="s3">'pink'</span><span class="s2">)</span>
<span class="s2">ax.scatter(filtered_label4[:</span><span class="s1">,</span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">filtered_label4[:</span><span class="s1">,</span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">color = </span><span class="s3">'olive'</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">centroids</span>
<span class="s0">#%% 
</span><span class="s2">y_kmeans</span>
<span class="s0">#%% 
</span><span class="s2">h = </span><span class="s4">0.02</span>
<span class="s2">x_min</span><span class="s1">, </span><span class="s2">x_max = X[:</span><span class="s1">, </span><span class="s4">0</span><span class="s2">].min() - </span><span class="s4">1</span><span class="s1">, </span><span class="s2">X[:</span><span class="s1">, </span><span class="s4">0</span><span class="s2">].max() + </span><span class="s4">1</span>
<span class="s2">y_min</span><span class="s1">, </span><span class="s2">y_max = X[:</span><span class="s1">, </span><span class="s4">1</span><span class="s2">].min() - </span><span class="s4">1</span><span class="s1">, </span><span class="s2">X[:</span><span class="s1">, </span><span class="s4">1</span><span class="s2">].max() + </span><span class="s4">1</span>
<span class="s2">xx</span><span class="s1">, </span><span class="s2">yy = np.meshgrid(np.arange(x_min</span><span class="s1">, </span><span class="s2">x_max</span><span class="s1">, </span><span class="s2">h)</span><span class="s1">, </span><span class="s2">np.arange(y_min</span><span class="s1">, </span><span class="s2">y_max</span><span class="s1">, </span><span class="s2">h))</span>
<span class="s2">Z = kmeans.predict(np.c_[xx.ravel()</span><span class="s1">, </span><span class="s2">yy.ravel()])</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(</span><span class="s4">1 </span><span class="s1">, </span><span class="s2">figsize = (</span><span class="s4">15 </span><span class="s1">, </span><span class="s4">7</span><span class="s2">) )</span>
<span class="s2">plt.clf()</span>
<span class="s2">Z = Z.reshape(xx.shape)</span>
<span class="s2">plt.imshow(Z </span><span class="s1">, </span><span class="s2">interpolation=</span><span class="s3">'nearest'</span><span class="s1">,</span>
           <span class="s2">extent=(xx.min()</span><span class="s1">, </span><span class="s2">xx.max()</span><span class="s1">, </span><span class="s2">yy.min()</span><span class="s1">, </span><span class="s2">yy.max())</span><span class="s1">,</span>
           <span class="s2">cmap = plt.cm.Pastel2</span><span class="s1">, </span><span class="s2">aspect = </span><span class="s3">'auto'</span><span class="s1">, </span><span class="s2">origin=</span><span class="s3">'lower'</span><span class="s2">)</span>

<span class="s2">plt.scatter( x = </span><span class="s3">'CLIENT_AGE' </span><span class="s1">,</span><span class="s2">y = </span><span class="s3">'CLIENT_VRD_MOY' </span><span class="s1">, </span><span class="s2">data = data </span><span class="s1">, </span><span class="s2">c =y_kmeans </span><span class="s1">,</span>
            <span class="s2">s = </span><span class="s4">200 </span><span class="s2">)</span>
<span class="s2">plt.scatter(x = centroids[: </span><span class="s1">, </span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">y =  centroids[: </span><span class="s1">, </span><span class="s4">1</span><span class="s2">] </span><span class="s1">, </span><span class="s2">s = </span><span class="s4">300 </span><span class="s1">, </span><span class="s2">c =  </span><span class="s3">'black' </span><span class="s1">, </span><span class="s2">alpha = </span><span class="s4">0.5</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">) </span><span class="s1">, </span><span class="s2">plt.xlabel(</span><span class="s3">'Age'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">sns.countplot(y_kmeans)</span>

<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.scatterplot(</span>
    <span class="s2">x=df_customers_kmeans[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">]</span><span class="s1">,</span>
    <span class="s2">y=df_customers_kmeans[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">]</span><span class="s1">,</span>
    <span class="s2">hue=df_customers_kmeans[</span><span class="s3">'Segment'</span><span class="s2">]</span><span class="s1">,</span>
    <span class="s2">palette=[</span><span class="s3">'g'</span><span class="s1">,</span><span class="s3">'r'</span><span class="s1">,</span><span class="s3">'c'</span><span class="s1">,</span><span class="s3">'m'</span><span class="s2">]</span>
<span class="s2">)</span>
<span class="s2">plt.scatter(</span><span class="s4">62</span><span class="s1">, </span><span class="s4">160000 </span><span class="s1">, </span><span class="s2">s=</span><span class="s4">60000</span><span class="s1">, </span><span class="s2">facecolors=</span><span class="s3">'none'</span><span class="s1">, </span><span class="s2">edgecolors=</span><span class="s3">'#FF8400' </span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Age vs VRD in each segment'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">30</span><span class="s1">, </span><span class="s4">15</span><span class="s2">))</span>
<span class="s2">sns.violinplot(</span>
    <span class="s2">x=df_customers_kmeans[</span><span class="s3">'CLIENT_PROFESSION'</span><span class="s2">]</span><span class="s1">,</span>
    <span class="s2">y=df_customers_kmeans[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">]</span><span class="s1">,</span>
    <span class="s2">hue=df_customers_kmeans[</span><span class="s3">'Segment'</span><span class="s2">]</span><span class="s1">,</span>
    <span class="s2">palette=[</span><span class="s3">'g'</span><span class="s1">,</span><span class="s3">'r'</span><span class="s1">,</span><span class="s3">'c'</span><span class="s1">,</span><span class="s3">'m'</span><span class="s2">]</span>
<span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Profession vs VRD in each segment'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s2">## Age VS Average Monthly Flow 
</span><span class="s0">#%% 
</span><span class="s2">X1=data[[</span><span class="s3">'CLIENT_AGE'</span><span class="s1">,</span><span class="s3">'CLIENT_MMM'</span><span class="s2">]]</span>
<span class="s2">inertia1=[]</span>
<span class="s1">for </span><span class="s2">n </span><span class="s1">in </span><span class="s2">range(</span><span class="s4">1 </span><span class="s1">, </span><span class="s4">11</span><span class="s2">):</span>
    <span class="s2">model1=KMeans(n_clusters=n</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">n_init=</span><span class="s4">10</span><span class="s1">, </span><span class="s2">max_iter=</span><span class="s4">300</span><span class="s1">, </span><span class="s2">tol=</span><span class="s4">0.0001</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">111</span><span class="s1">,</span><span class="s2">algorithm=</span><span class="s3">'elkan'</span><span class="s2">)</span>
    <span class="s2">model1.fit(X1)</span>
    <span class="s2">inertia1.append(model1.inertia_)</span>
<span class="s2">print(inertia1)</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">8</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">plt.plot(list(range(</span><span class="s4">1 </span><span class="s1">, </span><span class="s4">11</span><span class="s2">))</span><span class="s1">, </span><span class="s2">inertia1</span><span class="s1">, </span><span class="s2">color=</span><span class="s3">'royalblue'</span><span class="s1">, </span><span class="s2">marker=</span><span class="s3">'o'</span><span class="s1">,</span><span class="s2">linewidth=</span><span class="s4">2</span><span class="s1">, </span><span class="s2">markersize=</span><span class="s4">12</span><span class="s1">, </span><span class="s2">markerfacecolor=</span><span class="s3">'m'</span><span class="s1">, </span><span class="s2">markeredgecolor=</span><span class="s3">'m'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Inertia vs. Number of Clusters'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Number of Clusters'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Inertia'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">model1=KMeans(n_clusters=</span><span class="s4">4</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">n_init=</span><span class="s4">10</span><span class="s1">, </span><span class="s2">max_iter=</span><span class="s4">300</span><span class="s1">, </span><span class="s2">tol=</span><span class="s4">0.0001</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">111</span><span class="s1">,</span><span class="s2">algorithm=</span><span class="s3">'elkan'</span><span class="s2">)</span>
<span class="s2">model1.fit(X1)</span>
<span class="s2">labels1=model1.labels_</span>
<span class="s2">centroids1=model1.cluster_centers_</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">11</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">sns.set_style(</span><span class="s3">'white'</span><span class="s2">)</span>
<span class="s2">plt.scatter(x=data[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y=data[</span><span class="s3">'CLIENT_MMM'</span><span class="s2">]</span><span class="s1">,</span><span class="s2">c=labels1</span><span class="s1">,</span><span class="s2">cmap=</span><span class="s3">'winter'</span><span class="s2">)</span>
<span class="s2">plt.scatter(x = centroids1[: </span><span class="s1">, </span><span class="s4">0</span><span class="s2">] </span><span class="s1">, </span><span class="s2">y =  centroids1[: </span><span class="s1">, </span><span class="s4">1</span><span class="s2">]</span><span class="s1">, </span><span class="s2">s = </span><span class="s4">300 </span><span class="s1">, </span><span class="s2">c = </span><span class="s3">'red'</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Age'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Client MMM'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Customer Segmentation Based on Age and Spending Score'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s2">## Average Monthly Flow VS Actual Deposit Value 
 
</span><span class="s0">#%% 
</span><span class="s2">X2=data[[</span><span class="s3">'CLIENT_MMM'</span><span class="s1">,</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">]]</span>
<span class="s2">inertia2=[]</span>
<span class="s1">for </span><span class="s2">n </span><span class="s1">in </span><span class="s2">range(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">11</span><span class="s2">):</span>
    <span class="s2">model2=KMeans(n_clusters=n</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">n_init=</span><span class="s4">10</span><span class="s1">, </span><span class="s2">max_iter=</span><span class="s4">300</span><span class="s1">, </span><span class="s2">tol=</span><span class="s4">0.0001</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">111</span><span class="s1">, </span><span class="s2">algorithm=</span><span class="s3">'elkan'</span><span class="s2">)</span>
    <span class="s2">model2.fit(X2)</span>
    <span class="s2">inertia2.append(model2.inertia_)</span>
<span class="s2">print(inertia2)</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">8</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">plt.plot(list(range(</span><span class="s4">1 </span><span class="s1">, </span><span class="s4">11</span><span class="s2">))</span><span class="s1">, </span><span class="s2">inertia2</span><span class="s1">, </span><span class="s2">color=</span><span class="s3">'royalblue'</span><span class="s1">, </span><span class="s2">marker=</span><span class="s3">'o'</span><span class="s1">,</span><span class="s2">linewidth=</span><span class="s4">2</span><span class="s1">, </span><span class="s2">markersize=</span><span class="s4">12</span><span class="s1">, </span><span class="s2">markerfacecolor=</span><span class="s3">'m'</span><span class="s1">, </span><span class="s2">markeredgecolor=</span><span class="s3">'m'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Inertia vs. Number of Clusters'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Number of Clusters'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Inertia'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">model2=KMeans(n_clusters=</span><span class="s4">4</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">n_init=</span><span class="s4">10</span><span class="s1">, </span><span class="s2">max_iter=</span><span class="s4">300</span><span class="s1">, </span><span class="s2">tol=</span><span class="s4">0.0001</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">111</span><span class="s1">, </span><span class="s2">algorithm=</span><span class="s3">'elkan'</span><span class="s2">)</span>
<span class="s2">model2.fit(X2)</span>
<span class="s2">centroids2=model2.cluster_centers_</span>
<span class="s2">labels2=model2.labels_</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">11</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">sns.set_style(</span><span class="s3">'white'</span><span class="s2">)</span>
<span class="s2">plt.scatter(x=data[</span><span class="s3">'CLIENT_MMM'</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y=data[</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">]</span><span class="s1">,</span><span class="s2">c=labels2</span><span class="s1">,</span><span class="s2">cmap=</span><span class="s3">'winter'</span><span class="s2">)</span>
<span class="s2">plt.scatter(centroids2[:</span><span class="s1">,</span><span class="s4">0</span><span class="s2">]</span><span class="s1">, </span><span class="s2">centroids2[:</span><span class="s1">,</span><span class="s4">1</span><span class="s2">]</span><span class="s1">,</span><span class="s2">c=</span><span class="s3">'red'</span><span class="s1">,</span><span class="s2">s=</span><span class="s4">200</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'MMM'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'VRD'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Customer Segmentation Based on Annual Income and Spending Score'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">X3=data[[</span><span class="s3">'CLIENT_AGE'</span><span class="s1">, </span><span class="s3">'CLIENT_MMM'</span><span class="s1">, </span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s2">]]</span>
<span class="s2">inertia3=[]</span>
<span class="s1">for </span><span class="s2">n </span><span class="s1">in </span><span class="s2">range (</span><span class="s4">1</span><span class="s1">,</span><span class="s4">10</span><span class="s2">):</span>
    <span class="s2">model3=KMeans(n_clusters=n</span><span class="s1">,</span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">n_init=</span><span class="s4">10</span><span class="s1">, </span><span class="s2">max_iter=</span><span class="s4">300</span><span class="s1">, </span><span class="s2">tol=</span><span class="s4">0.0001</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">111</span><span class="s1">,</span><span class="s2">algorithm=</span><span class="s3">'elkan'</span><span class="s2">)</span>
    <span class="s2">model3.fit(X3)</span>
    <span class="s2">inertia3.append(model3.inertia_)</span>
<span class="s2">print(inertia3)</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">8</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">plt.plot(list(range (</span><span class="s4">1</span><span class="s1">,</span><span class="s4">10</span><span class="s2">))</span><span class="s1">,</span><span class="s2">inertia3</span><span class="s1">, </span><span class="s2">color=</span><span class="s3">'indigo'</span><span class="s1">,</span><span class="s2">marker=</span><span class="s3">'o'</span><span class="s1">, </span><span class="s2">linewidth=</span><span class="s4">2</span><span class="s1">, </span><span class="s2">markersize=</span><span class="s4">12</span><span class="s1">, </span><span class="s2">markerfacecolor=</span><span class="s3">'violet'</span><span class="s1">, </span><span class="s2">markeredgecolor=</span><span class="s3">'violet'</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Number of Clusters'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Inertia'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Inertia vs. Number of Clusters'</span><span class="s1">,</span><span class="s2">fontsize=</span><span class="s4">18</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">model3=KMeans(n_clusters=</span><span class="s4">4</span><span class="s1">,</span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">n_init=</span><span class="s4">10</span><span class="s1">, </span><span class="s2">max_iter=</span><span class="s4">300</span><span class="s1">, </span><span class="s2">tol=</span><span class="s4">0.0001</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">111</span><span class="s1">,</span><span class="s2">algorithm=</span><span class="s3">'elkan'</span><span class="s2">)</span>
<span class="s2">model3.fit(X3)</span>
<span class="s2">centroids3=model3.cluster_centers_</span>
<span class="s2">labels3=model3.labels_</span>
<span class="s0">#%% 
</span><span class="s1">import </span><span class="s2">plotly.express </span><span class="s1">as </span><span class="s2">px</span>
<span class="s2">%matplotlib inline</span>
<span class="s2">fig=px.scatter_3d(data_frame=data</span><span class="s1">,</span><span class="s2">x=</span><span class="s3">'CLIENT_AGE'</span><span class="s1">,</span><span class="s2">y=</span><span class="s3">'CLIENT_MMM'</span><span class="s1">,</span><span class="s2">z=</span><span class="s3">'CLIENT_VRD_MOY'</span><span class="s1">,</span><span class="s2">color=labels3</span><span class="s1">, </span><span class="s2">color_continuous_scale=</span><span class="s3">'bluered'</span><span class="s2">)</span>
<span class="s2">fig.update_layout(</span>
    <span class="s2">title={</span>
        <span class="s3">'text'</span><span class="s2">: </span><span class="s3">'Customer Segmentation Based on Age, Average monthly flow and Actual values of deposits'</span><span class="s1">,</span>
        <span class="s3">'y'</span><span class="s2">:</span><span class="s4">0.95</span><span class="s1">,</span>
        <span class="s3">'x'</span><span class="s2">:</span><span class="s4">0.5</span><span class="s1">,</span>
        <span class="s3">'xanchor'</span><span class="s2">: </span><span class="s3">'center'</span><span class="s1">,</span>
        <span class="s3">'yanchor'</span><span class="s2">: </span><span class="s3">'top'</span><span class="s2">})</span>
<span class="s2">fig.show()</span>
<span class="s0">#%% 
</span><span class="s2">pca = PCA()</span>
<span class="s2">pca.fit(scaled)</span>
<span class="s0">#%% 
</span><span class="s2">pca.explained_variance_ratio_</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">10</span><span class="s1">,</span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">plt.plot(pca.explained_variance_ratio_.cumsum()</span><span class="s1">, </span><span class="s2">marker= </span><span class="s3">'o'</span><span class="s1">, </span><span class="s2">linestyle=</span><span class="s3">'--'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Explained Variance by Components'</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Number of Components'</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Cumulative Explained Variance'</span><span class="s2">)</span>
<span class="s2">plt.xlim(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">10</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">pca = PCA(n_components=</span><span class="s4">2</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">pca.fit(scaled)</span>
<span class="s0">#%% 
</span><span class="s2">pca.transform(scaled)</span>
<span class="s0">#%% 
</span><span class="s2">scores_pca = pca.transform(scaled)</span>
<span class="s0">#%% 
</span><span class="s2">wcss=[]</span>
<span class="s1">for </span><span class="s2">i </span><span class="s1">in </span><span class="s2">range(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">11</span><span class="s2">):</span>
    <span class="s2">kmeans_pca = KMeans(n_clusters= i</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">kmeans_pca.fit(scores_pca)</span>
    <span class="s2">wcss.append(kmeans_pca.inertia_)</span>
<span class="s0">#%% 
</span><span class="s2">plt.plot(range(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">11</span><span class="s2">)</span><span class="s1">, </span><span class="s2">wcss)</span>
<span class="s2">plt.title(</span><span class="s3">'The Elbow Method'</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'no of clusters'</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'wcss'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">kmeans_pca = KMeans(n_clusters=</span><span class="s4">4</span><span class="s1">, </span><span class="s2">init=</span><span class="s3">'k-means++'</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">42</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">kmeans_pca.fit(scores_pca)</span>
<span class="s0">#%% 
</span><span class="s2">data_pca = pd.concat([data.reset_index(drop=</span><span class="s1">True</span><span class="s2">)</span><span class="s1">,</span><span class="s2">pd.DataFrame(scores_pca)]</span><span class="s1">,</span><span class="s2">axis=</span><span class="s4">1</span><span class="s2">)</span>
<span class="s2">data_pca.columns.values[-</span><span class="s4">2</span><span class="s2">:]=[</span><span class="s3">'Component 1'</span><span class="s1">,</span><span class="s3">'Component 2'</span><span class="s2">]</span>
<span class="s2">data_pca[</span><span class="s3">'SEGMENT_PCA'</span><span class="s2">] = kmeans_pca.labels_</span>
<span class="s0">#%% 
</span><span class="s2">data_pca</span>
<span class="s0">#%% 
</span><span class="s2">data_pca[data_pca[</span><span class="s3">'SEGMENT_PCA'</span><span class="s2">] == </span><span class="s4">0</span><span class="s2">]</span>
<span class="s0">#%% 
</span><span class="s2">data_pca[data_pca[</span><span class="s3">'SEGMENT_PCA'</span><span class="s2">] == </span><span class="s4">1</span><span class="s2">]</span>
<span class="s0">#%% 
</span><span class="s2">data_pca[data_pca[</span><span class="s3">'SEGMENT_PCA'</span><span class="s2">] == </span><span class="s4">2</span><span class="s2">]</span>

<span class="s0">#%% 
</span><span class="s2">data_pca[data_pca[</span><span class="s3">'SEGMENT_PCA'</span><span class="s2">] == </span><span class="s4">3</span><span class="s2">]</span>

<span class="s0">#%% 
</span><span class="s2">data_pca[</span><span class="s3">'SEGMENT'</span><span class="s2">] = data_pca[</span><span class="s3">'SEGMENT_PCA'</span><span class="s2">].map({</span><span class="s4">0</span><span class="s2">:</span><span class="s3">'first'</span><span class="s1">,</span>
                                                   <span class="s4">1</span><span class="s2">:</span><span class="s3">'second'</span><span class="s1">,</span>
                                                   <span class="s4">2</span><span class="s2">: </span><span class="s3">'third'</span><span class="s1">,</span>
                                                   <span class="s4">3</span><span class="s2">: </span><span class="s3">'fourth'</span><span class="s2">})</span>
<span class="s0">#%% 
#Plot data by PCA components</span>
<span class="s2">x_axis = data_pca[</span><span class="s3">'Component 1'</span><span class="s2">]</span>
<span class="s2">y_axis = data_pca[</span><span class="s3">'Component 2'</span><span class="s2">]</span>
<span class="s2">plt.figure(figsize = (</span><span class="s4">10</span><span class="s1">,</span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.scatterplot(x_axis </span><span class="s1">, </span><span class="s2">y_axis </span><span class="s1">, </span><span class="s2">hue = data_pca[</span><span class="s3">'SEGMENT'</span><span class="s2">]</span><span class="s1">, </span><span class="s2">palette = [</span><span class="s3">'g'</span><span class="s1">,</span><span class="s3">'r'</span><span class="s1">,</span><span class="s3">'c'</span><span class="s1">,</span><span class="s3">'m'</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">'Clusters by PCA component'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s1">def </span><span class="s2">draw_vector(v0</span><span class="s1">, </span><span class="s2">v1</span><span class="s1">, </span><span class="s2">ax=</span><span class="s1">None</span><span class="s2">):</span>
    <span class="s2">ax = ax </span><span class="s1">or </span><span class="s2">plt.gca()</span>
    <span class="s2">arrowprops=dict(arrowstyle=</span><span class="s3">'-&gt;'</span><span class="s1">,</span>
                    <span class="s2">linewidth=</span><span class="s4">2</span><span class="s1">,</span>
                    <span class="s2">shrinkA=</span><span class="s4">0</span><span class="s1">, </span><span class="s2">shrinkB=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s2">ax.annotate(</span><span class="s3">''</span><span class="s1">, </span><span class="s2">v1</span><span class="s1">, </span><span class="s2">v0</span><span class="s1">, </span><span class="s2">arrowprops=arrowprops)</span>

<span class="s0"># plot data</span>
<span class="s2">plt.scatter(data_pca.iloc[:</span><span class="s1">, </span><span class="s4">10</span><span class="s2">]</span><span class="s1">, </span><span class="s2">data_pca.iloc[:</span><span class="s1">, </span><span class="s4">11</span><span class="s2">]</span><span class="s1">, </span><span class="s2">alpha=</span><span class="s4">0.2</span><span class="s2">)</span>
<span class="s1">for </span><span class="s2">length</span><span class="s1">, </span><span class="s2">vector </span><span class="s1">in </span><span class="s2">zip(pca.explained_variance_</span><span class="s1">, </span><span class="s2">pca.components_):</span>
    <span class="s2">v = vector * </span><span class="s4">3 </span><span class="s2">* np.sqrt(length)</span>
    <span class="s2">draw_vector(pca.mean_</span><span class="s1">, </span><span class="s2">pca.mean_ + v)</span>
<span class="s2">plt.axis(</span><span class="s3">'equal'</span><span class="s2">);</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.countplot(x=</span><span class="s3">'SEGMENT_PCA'</span><span class="s1">, </span><span class="s2">data=data_pca</span><span class="s1">, </span><span class="s2">hue=</span><span class="s3">'PACK'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.countplot(x=</span><span class="s3">'SEGMENT_PCA'</span><span class="s1">, </span><span class="s2">data=data_pca)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s1">def </span><span class="s2">plot(attribute_category):</span>
    <span class="s2">attribute_category.value_counts().plot(kind=</span><span class="s3">&quot;bar&quot;</span><span class="s2">)</span>
    <span class="s2">plt.title(</span><span class="s3">&quot;attribute distribution&quot;</span><span class="s2">)</span>
    <span class="s2">plt.show()</span>
    <span class="s2">print(</span><span class="s3">&quot;</span><span class="s1">\n</span><span class="s3">&quot;</span><span class="s2">)</span>

    <span class="s2">pd.crosstab(attribute_category</span><span class="s1">,</span><span class="s2">data_pca.SEGMENT_PCA).T.plot(kind=</span><span class="s3">&quot;bar&quot;</span><span class="s1">,</span><span class="s2">stacked = </span><span class="s1">True</span><span class="s2">)</span>
    <span class="s2">plt.legend(bbox_to_anchor=(</span><span class="s4">1.0</span><span class="s1">, </span><span class="s4">0.5</span><span class="s2">))</span>
    <span class="s2">plt.title(</span><span class="s3">&quot;The ratio of  attribute category to y category (yes/no)&quot;</span><span class="s2">)</span>
    <span class="s2">plt.show()</span>

<span class="s0">#%% 
</span><span class="s2">plot(data_pca.CLIENT_PROFESSION)</span>
<span class="s0">#%% 
</span><span class="s2">bins= [</span><span class="s4">30</span><span class="s1">,</span><span class="s4">40</span><span class="s1">,</span><span class="s4">50</span><span class="s1">,</span><span class="s4">70</span><span class="s1">,</span><span class="s4">80</span><span class="s2">]</span>
<span class="s2">labels=[</span><span class="s3">'Young Adult'</span><span class="s1">,</span><span class="s3">'Adult'</span><span class="s1">,</span><span class="s3">'Middle Aged'</span><span class="s1">,</span><span class="s3">'Senior Citizen'</span><span class="s2">]</span>
<span class="s2">data_pca[</span><span class="s3">'AgeGroup'</span><span class="s2">] = pd.cut(data_pca[</span><span class="s3">'CLIENT_AGE'</span><span class="s2">]</span><span class="s1">, </span><span class="s2">bins=bins</span><span class="s1">, </span><span class="s2">labels=labels</span><span class="s1">, </span><span class="s2">right=</span><span class="s1">False</span><span class="s2">)</span>
<span class="s2">print (data_pca)</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.countplot(x=</span><span class="s3">'SEGMENT_PCA'</span><span class="s1">, </span><span class="s2">data=data_pca</span><span class="s1">, </span><span class="s2">hue=</span><span class="s3">'AgeGroup'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.countplot(x=</span><span class="s3">'SEGMENT_PCA'</span><span class="s1">, </span><span class="s2">data=data_pca</span><span class="s1">, </span><span class="s2">hue=</span><span class="s3">'PACK'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.countplot(x=</span><span class="s3">'SEGMENT_PCA'</span><span class="s1">, </span><span class="s2">data=data_pca</span><span class="s1">, </span><span class="s2">hue=</span><span class="s3">'CLIENT_NOMBRE_CARTES'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.barplot(x=data_pca[</span><span class="s3">&quot;SEGMENT_PCA&quot;</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y=data_pca[</span><span class="s3">&quot;CLIENT_MMM&quot;</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">&quot;VRD vs SEGMENT &quot;</span><span class="s1">, </span><span class="s2">size=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.barplot(x=data_pca[</span><span class="s3">&quot;SEGMENT_PCA&quot;</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y=data_pca[</span><span class="s3">&quot;CLIENT_VRD_MOY&quot;</span><span class="s2">]</span><span class="s1">, </span><span class="s2">hue=data_pca[</span><span class="s3">'AgeGroup'</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">&quot;VRD vs SEGMENT &quot;</span><span class="s1">, </span><span class="s2">size=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">8</span><span class="s1">, </span><span class="s4">30</span><span class="s2">))</span>
<span class="s2">sns.barplot(x=data_pca[</span><span class="s3">&quot;SEGMENT_PCA&quot;</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y=data_pca[</span><span class="s3">&quot;CLIENT_PROFESSION&quot;</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">&quot;VRD vs SEGMENT &quot;</span><span class="s1">, </span><span class="s2">size=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.xticks(rotation = </span><span class="s4">45</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">8</span><span class="s1">, </span><span class="s4">30</span><span class="s2">))</span>
<span class="s2">sns.barplot(x=data_pca[</span><span class="s3">&quot;CLIENT_VRD_MOY&quot;</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y=data_pca[</span><span class="s3">&quot;CLIENT_PROFESSION&quot;</span><span class="s2">])</span>
<span class="s2">plt.title(</span><span class="s3">&quot;VRD vs SEGMENT &quot;</span><span class="s1">, </span><span class="s2">size=</span><span class="s4">15</span><span class="s2">)</span>
<span class="s2">plt.xticks(rotation = </span><span class="s4">45</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">data_pca.columns</span>
<span class="s0">#%% 
</span><span class="s2">DColumns= [</span><span class="s3">'TOTAL_PACK'</span><span class="s1">, </span><span class="s3">'CLIENT_ENCOURS_ENGAGEMENT'</span><span class="s1">,</span>
       <span class="s3">'CLIENT_MMM'</span><span class="s1">, </span><span class="s3">'CLIENT_PROFESSION'</span><span class="s1">, </span><span class="s3">'CLIENT_TYPE_DEPOSANT'</span><span class="s1">,</span>
       <span class="s3">'CLIENT_VRD_MOY'</span><span class="s1">,</span><span class="s3">'PACK'</span><span class="s2">]</span>

<span class="s2">_</span><span class="s1">, </span><span class="s2">ax1 = plt.subplots(</span><span class="s4">4</span><span class="s1">,</span><span class="s4">2</span><span class="s1">, </span><span class="s2">figsize=(</span><span class="s4">25</span><span class="s1">,</span><span class="s4">22</span><span class="s2">))</span>
<span class="s2">plt.suptitle(</span><span class="s3">'Income Vs Amount Spent By Clusters'</span><span class="s2">)</span>

<span class="s1">for </span><span class="s2">i</span><span class="s1">, </span><span class="s2">col </span><span class="s1">in </span><span class="s2">enumerate(DColumns):</span>
    <span class="s2">sns.scatterplot(x=</span><span class="s3">'CLIENT_AGE'</span><span class="s1">, </span><span class="s2">y=col</span><span class="s1">, </span><span class="s2">data=data_pca</span><span class="s1">, </span><span class="s2">ax=ax1[i//</span><span class="s4">2</span><span class="s1">, </span><span class="s2">i%</span><span class="s4">2</span><span class="s2">]</span><span class="s1">,</span><span class="s2">hue=</span><span class="s3">'SEGMENT_PCA'</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">_</span><span class="s1">, </span><span class="s2">ax1 = plt.subplots(</span><span class="s4">4</span><span class="s1">,</span><span class="s4">2</span><span class="s1">, </span><span class="s2">figsize=(</span><span class="s4">25</span><span class="s1">,</span><span class="s4">22</span><span class="s2">))</span>
<span class="s1">for </span><span class="s2">i</span><span class="s1">, </span><span class="s2">col </span><span class="s1">in </span><span class="s2">enumerate(DColumns):</span>
    <span class="s2">sns.barplot(x=</span><span class="s3">'SEGMENT_PCA'</span><span class="s1">, </span><span class="s2">y=col</span><span class="s1">, </span><span class="s2">data=data_pca</span><span class="s1">, </span><span class="s2">ax=ax1[i//</span><span class="s4">2</span><span class="s1">, </span><span class="s2">i%</span><span class="s4">2</span><span class="s2">])</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">, </span><span class="s4">8</span><span class="s2">))</span>
<span class="s2">sns.boxenplot(x=data_pca[</span><span class="s3">&quot;SEGMENT_PCA&quot;</span><span class="s2">]</span><span class="s1">, </span><span class="s2">y=data_pca[</span><span class="s3">&quot;CLIENT_AGE&quot;</span><span class="s2">])</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
 # Bar plot of explained_variance</span>
<span class="s2">plt.bar(</span>
    <span class="s2">range(</span><span class="s4">1</span><span class="s1">,</span><span class="s2">len(pca.explained_variance_)+</span><span class="s4">1</span><span class="s2">)</span><span class="s1">,</span>
    <span class="s2">pca.explained_variance_</span>
    <span class="s2">)</span>


<span class="s2">plt.xlabel(</span><span class="s3">'PCA Feature'</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Explained variance'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Feature Explained Variance'</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">plt.plot(pca.explained_variance_ratio_.cumsum()</span><span class="s1">, </span><span class="s2">lw=</span><span class="s4">3</span><span class="s1">, </span><span class="s2">color=</span><span class="s3">'#087E8B'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Cumulative explained variance by number of principal components'</span><span class="s1">, </span><span class="s2">size=</span><span class="s4">20</span><span class="s2">)</span>
<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">pip install -U yellowbrick</span>
<span class="s0">#%% 
</span><span class="s1">from </span><span class="s2">yellowbrick.cluster </span><span class="s1">import </span><span class="s2">KElbowVisualizer</span>

<span class="s2">elbow_graph = KElbowVisualizer(KMeans(random_state=</span><span class="s4">43</span><span class="s2">)</span><span class="s1">, </span><span class="s2">k=</span><span class="s4">10</span><span class="s2">)</span>
<span class="s2">elbow_graph.fit(scaled)</span>
<span class="s2">elbow_graph.show()</span>
<span class="s0">#%% md 
</span><span class="s2">--&gt; Elbow at k = 4 and distortion score at score = 1.50 
</span><span class="s0">#%% 
</span><span class="s1">from </span><span class="s2">sklearn.metrics </span><span class="s1">import </span><span class="s2">silhouette_score</span>

<span class="s2">clusters = [</span><span class="s4">2</span><span class="s1">,</span><span class="s4">3</span><span class="s1">,</span><span class="s4">4</span><span class="s1">,</span><span class="s4">5</span><span class="s1">,</span><span class="s4">6</span><span class="s1">,</span><span class="s4">7</span><span class="s1">,</span><span class="s4">8</span><span class="s1">,</span><span class="s4">9</span><span class="s1">,</span><span class="s4">10</span><span class="s2">] </span><span class="s0"># number of clusters</span>
<span class="s2">s_scores = [] </span><span class="s0"># silhouette scores</span>

<span class="s1">for </span><span class="s2">n </span><span class="s1">in </span><span class="s2">clusters:</span>
    <span class="s2">kmeans = KMeans(n_clusters = n</span><span class="s1">, </span><span class="s2">random_state=</span><span class="s4">43</span><span class="s2">).fit(scaled)</span>
    <span class="s2">silhouette = silhouette_score(scaled</span><span class="s1">, </span><span class="s2">kmeans.labels_)</span>
    <span class="s2">s_scores.append(silhouette)</span>

<span class="s2">plt.figure(figsize=(</span><span class="s4">12</span><span class="s1">,</span><span class="s4">6</span><span class="s2">))</span>
<span class="s2">sns.lineplot(clusters</span><span class="s1">, </span><span class="s2">s_scores</span><span class="s1">, </span><span class="s2">marker=</span><span class="s3">'o'</span><span class="s2">)</span>
<span class="s2">plt.title(</span><span class="s3">'Silhouette Score Method'</span><span class="s2">)</span>
<span class="s2">plt.xlabel(</span><span class="s3">'Number Of Clusters'</span><span class="s2">)</span>
<span class="s2">plt.ylabel(</span><span class="s3">'Silhouette Score'</span><span class="s2">)</span>
<span class="s2">plt.show()</span></pre>
</body>
</html>